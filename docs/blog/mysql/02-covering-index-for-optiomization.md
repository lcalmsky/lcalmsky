## 커버링 인덱스(Covering Index)를 통한 성능 최적화

### 커버링 인덱스란?

쿼리의 필요한 데이터를 인덱스 자체에서 모두 제공하여 디스크에서 별도의 테이블 데이터를 읽지 않고도 원하는 결과를 얻을 수 있는 인덱스입니다. 이는 쿼리의 성능을 향상시킬 수 있는 중요한 개념 중 하나입니다.

일반적으로 쿼리에서는 인덱스를 사용하여 특정 조건을 만족하는 행을 찾은 후, 해당 행의 데이터를 테이블에서 가져와야 합니다. 이때, 커버링 인덱스를 사용하면 인덱스 자체가 원하는 결과를 제공하여 테이블을 따로 참조하지 않아도 되기 때문에 I/O 비용이 크게 감소합니다.

커버링 인덱스를 사용하면 다음과 같은 이점이 있습니다.

* 쿼리 성능 향상: 디스크 I/O를 줄여 쿼리 실행 속도가 향상됩니다. 특히, 대량의 데이터를 처리하는 경우에 뚜렷한 성능 향상을 가져올 수 있습니다. 
* 인덱스만으로 결과 획득: 특정 컬럼들이 인덱스에 모두 포함되어 있기 때문에 테이블을 참조하지 않아도 필요한 데이터를 얻을 수 있습니다.

커버링 인덱스를 구성하기 위해서는 쿼리에서 필요한 컬럼들이 인덱스에 모두 포함되어야 합니다. 그렇지 않으면 테이블에서 추가적으로 데이터를 읽어야 하므로 커버링 인덱스의 이점을 얻을 수 없습니다.

커버링 인덱스의 예시를 살펴보겠습니다. 만약 다음과 같은 테이블이 있다고 가정하고,

```mysql
CREATE TABLE users (
user_id INT PRIMARY KEY,
username VARCHAR(50),
email VARCHAR(100),
registration_date DATE
);

CREATE INDEX idx_username_registration_date ON users (username, registration_date);
```

다음과 같은 쿼리가 있다고 가정합니다.

```mysql
SELECT username, registration_date
FROM users
WHERE username = 'john_doe';
```

만약 idx_username_registration_date가 커버링 인덱스인 경우, 이 쿼리는 인덱스만으로 결과를 반환할 수 있습니다. 커버링 인덱스가 아니라면 테이블에서 registration_date를 추가로 읽어와야 합니다.

커버링 인덱스는 데이터베이스의 성능 최적화에 중요한 역할을 하며, 특히 읽기 쿼리가 자주 사용되는 상황에서 유용합니다.

### 커버링 인덱스가 필요한 상황

1. 특정 컬럼을 자주 조회할 때
2. 조인 연산 비용 줄이기
3. 읽기 성능이 필요한 경우

### 고려할 점

* 인덱스의 크기: 인덱스가 커지면 인덱스 블록에 들어갈 수 있는 데이터 수는 감소함
* 쓰기 비용: 인덱스에 추가된 컬럼이 자주 업데이트되는 경우 추가적인 쓰기 비용이 발생할 수 있음
* 컬럼 크기: 큰 크기의 컬럼(VARCHAR(255) 등)은 인덱스로 추가하기 비효율적일 수 있음
* 카디널리티: 카디널리티가 낮은 값의 컬럼을 인덱스로 추가할 경우 읽기 성능이 향상되지 않을 수 있음

### 실습

실행 계획 결과의 type = ref인 경우 인덱스를 동등 조건으로만 이용해서 검색했음을 의미합니다. 즉, 효율적으로 레코드에 접근하고 있다는 뜻입니다.

커버링 인덱스를 사용중인지 확인하려면 실행 계획 결과의 extra 컬럼의 using index라는 메시지와 key 컬럼에 해당 인덱스명이 있어야합니다.